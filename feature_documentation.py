# Feature Documentation for Random Sampling SVM
# ================================================

"""
完整特徵組合說明文件

本程式使用的特徵組合包含以下七大類特徵：

1. 基本特徵 (Basic Features) - 10個
2. 二階動差特徵 (Second Moments) - 3個  
3. 侵蝕特徵 (Erosion Features) - 3個
4. 座標特徵 (Coordinate Features) - 2K個
5. 方向特徵 (Direction Features) - 2K個
6. 歸一化座標特徵 (Normalized Coordinate Features) - 2K個
7. 筆劃比例特徵 (Stroke Ratio Features) - 2K個

其中 K = 可靠端點數 + 可靠轉彎點數
總特徵維度 ≈ 16 + 6K 個
"""

# ==============================================
# 1. 基本特徵 (Basic Features) - 10個
# ==============================================
"""
來源：week3.py 的 extract_features_with_moments() 函數前10個特徵

f1-f5: 垂直投影特徵 (Vertical Projection Features)
- f1: 上半部分的筆劃密度
- f2: 中上部分的筆劃密度  
- f3: 中心部分的筆劃密度
- f4: 中下部分的筆劃密度
- f5: 下半部分的筆劃密度

f6-f10: 水平投影特徵 (Horizontal Projection Features)  
- f6: 左端部分的筆劃密度
- f7: 中左部分的筆劃密度
- f8: 中心部分的筆劃密度
- f9: 中右部分的筆劃密度
- f10: 右端部分的筆劃密度

物理意義：描述字跡在不同區域的筆劃分布，反映字形的整體結構
"""

# ==============================================
# 2. 二階動差特徵 (Second Moments) - 3個
# ==============================================
"""
來源：week3.py 的 extract_features_with_moments() 函數位置10-13

V_2_0: x方向的二階中心動差
- 公式: Σ(x - x̄)² * I(x,y) / Σ I(x,y)
- 物理意義: 字跡在水平方向的擴散程度

V_1_1: xy方向的混合二階中心動差  
- 公式: Σ(x - x̄)(y - ȳ) * I(x,y) / Σ I(x,y)
- 物理意義: 字跡的斜率和傾斜特性

V_0_2: y方向的二階中心動差
- 公式: Σ(y - ȳ)² * I(x,y) / Σ I(x,y)  
- 物理意義: 字跡在垂直方向的擴散程度

應用：這些特徵能夠捕捉字跡的幾何形狀特性，對於區分不同字形很有效
"""

# ==============================================
# 3. 侵蝕特徵 (Erosion Features) - 3個  
# ==============================================
"""
來源：week3.py 的 calculate_erosion_features() 函數

使用不同大小的結構元素對筆劃進行形態學侵蝕操作：

e1: 小型結構元素侵蝕後的面積比例
- 結構元素: 3x3 圓形
- 物理意義: 細節保留程度，反映筆劃粗細

e2: 中型結構元素侵蝕後的面積比例  
- 結構元素: 5x5 圓形
- 物理意義: 中等尺度結構保留程度

e3: 大型結構元素侵蝕後的面積比例
- 結構元素: 7x7 圓形  
- 物理意義: 主體結構保留程度，反映整體筆劃厚度

應用：這些特徵對筆劃粗細、斷筆、連筆等書寫特性很敏感
"""

# ==============================================
# 4. 座標特徵 (Coordinate Features) - 2K個
# ==============================================
"""
來源：自定義的 _extract_coordinate_features() 函數

針對每個可靠特徵點提取其絕對座標：

端點座標 (End Points Coordinates):
- 每個可靠端點: (x, y) 座標
- 端點定義: 筆劃角度 < 35° 的點
- 物理意義: 筆劃的起始和結束位置

轉彎點座標 (Turning Points Coordinates):  
- 每個可靠轉彎點: (x, y) 座標
- 轉彎點定義: 筆劃角度在 35°-150° 之間的點
- 物理意義: 筆劃的轉折和彎曲位置

可靠性判斷標準：
- 在標準字跡的前5個樣本中能穩定匹配
- 異常值比例 < 40%

應用：絕對位置信息有助於區分字形的空間結構差異
"""

# ==============================================
# 5. 方向特徵 (Direction Features) - 2K個
# ==============================================
"""
來源：week7.py 的 phi_matrix() 和角度計算

針對每個可靠特徵點的方向信息：

角度分解 (Angle Decomposition):
- cos(角度): 水平方向分量
- sin(角度): 垂直方向分量

角度計算方法：
- 使用 week7 的 phi_matrix(L=3) 複數遮罩
- 在 7x7 鄰域內進行卷積運算
- 提取複數結果的相位角

物理意義：
- 反映筆劃在該點的書寫方向
- 對於識別筆順和書寫習慣很重要
- cos/sin 分解避免了角度的週期性問題

應用：方向特徵對於區分相似字形（如 6 和 9）特別有效
"""

# ==============================================  
# 6. 歸一化座標特徵 (Normalized Coordinate Features) - 2K個
# ==============================================
"""
來源：week7.py 的 coordinate_normalization_m_custom() 和 coordinate_normalization_n_custom()

將絕對座標轉換為相對座標：

m_hat (x方向歸一化座標):
- 公式: (x - x_min) / (x_max - x_min) * 100
- 範圍: 0-100
- 物理意義: 在字跡寬度方向上的相對位置

n_hat (y方向歸一化座標):  
- 公式: (y - y_min) / (y_max - y_min) * 100
- 範圍: 0-100
- 物理意義: 在字跡高度方向上的相對位置

優點：
- 消除了字跡大小變化的影響
- 對縮放和平移變換具有不變性
- 更好地反映字形的比例關係

應用：特別適合處理不同大小和位置的手寫字
"""

# ==============================================
# 7. 筆劃比例特徵 (Stroke Ratio Features) - 2K個  
# ==============================================
"""
來源：week7.py 的 stroke_ratio_m_custom() 和 stroke_ratio_n_custom()

計算累積筆劃分布比例：

m_ratio (x方向累積比例):
- 公式: Σ(筆劃像素 x座標 ≤ 當前點x座標) / 總筆劃像素數
- 範圍: 0-1
- 物理意義: 當前點左側的筆劃密度累積比例

n_ratio (y方向累積比例):
- 公式: Σ(筆劃像素 y座標 ≤ 當前點y座標) / 總筆劃像素數  
- 範圍: 0-1
- 物理意義: 當前點上方的筆劃密度累積比例

應用：
- 反映筆劃的質量分布特性
- 對於識別筆劃的相對重要性很有用
- 有助於區分筆劃密集和稀疏的區域
"""

# ==============================================
# 特徵選擇和可靠性分析
# ==============================================
"""
可靠特徵點的判定標準：

1. 一致性檢驗：
   - 在標準字跡的前5個樣本中進行匹配
   - 計算距離的平均值和標準差
   - 異常值定義: 距離 > 平均值 + 標準差

2. 可靠性閾值：
   - 異常值比例 < 40%
   - 匹配成功次數 ≥ 3次

3. 距離計算權重：
   - 方向權重: 8.0 (重視方向一致性)
   - 歸一化座標權重: 1.0/1000 (位置匹配)  
   - 筆劃比例權重: 1.0/10 (分布匹配)
"""

# ==============================================
# 特徵維度統計
# ==============================================
"""
每個數字的特徵維度計算：

固定特徵: 16個
- 基本特徵: 10個
- 二階動差: 3個  
- 侵蝕特徵: 3個

變動特徵: 6K個 (K = 可靠特徵點數)
- 座標特徵: 2K個 (每點2維: x, y)
- 方向特徵: 2K個 (每點2維: cos, sin)  
- 歸一化座標: 2K個 (每點2維: m_hat, n_hat)
- 筆劃比例: 2K個 (每點2維: m_ratio, n_ratio)

總維度 = 16 + 6K

實際範圍:
- 數字1: 約22-28維 (K≈1-2)
- 數字8: 約40-52維 (K≈4-6)  
- 平均: 約30-35維
"""